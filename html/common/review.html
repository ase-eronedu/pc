

<div class="review-list-wrap">
  <ul class="review-list">
    <li id="reviewRegist">
      <div class="review regist">
        <div class="byte"><em>0</em>/3000</div>
        <div class="cont">
          <div class="desc">
            <div class="name-area">
                <p class="name">홍길동</p>
            </div>
          </div>
        </div>
        <div class="form">
          <textarea rows="1" placeholder="소중한 댓글을 남겨주세요. 단, 부적절한 표현은 삭제될 수 있어요."></textarea>
        </div>
        <div class="menu">
          <button type="button" class="btn-type5 btn-regist">등록</button>
        </div>
      </div>
    </li>
    <li>
      <div class="review view">
        <div class="layer-wrap">
          <button type="button" class="btn-menu"></button>
          <div class="menu-layer">
            <ul>
              <li><button type="button" class="btn-modify" onclick="$(this).parents('.review').hide();$(this).parents('.review').next().show();"><i class="ico-review-modify"></i><span>수정</span></button></li>
              <li><button type="button" class="btn-delete" onclick="alertOpen('댓글을 삭제하시겠습니까?', ['취소', '확인']);"><i class="ico-review-del"></i><span>삭제</span></button></li>
            </ul>
          </div>
        </div>
        <div class="cont">
          <div class="img"><img src="../images/common/default-user.svg" alt=""></div>
          <div class="desc">
            <div class="name-area">
                <p class="name">홍길동</p>
                <p class="date">2024년 4월 20일</p>
            </div>
          </div>
        </div>
        <div class="text">아주 유익했습니다.</div>
      </div>
      <div class="review modify" style="display:none;">
        <div class="byte"><em>0</em>/3000</div>
        <div class="cont">
          <div class="desc">
            <div class="name-area">
                <p class="name">홍길동</p>
            </div>
          </div>
        </div>
        <div class="form">
          <textarea rows="1"></textarea>
        </div>
        <div class="menu">
          <button type="button" class="btn-type5 btn-cancel">취소</button>
          <button type="button" class="btn-type5 st2 btn-regist">등록</button>
        </div>
      </div>
    </li>
    <li>
      <div class="review view">
        <div class="layer-wrap">
          <button type="button" class="btn-menu"></button>
          <div class="menu-layer">
            <ul>
              <li><button type="button" class="btn-modify" onclick="$(this).parents('.review').hide();$(this).parents('.review').next().show();"><i class="ico-review-modify"></i><span>수정</span></button></li>
              <li><button type="button" class="btn-delete" onclick="alertOpen('댓글을 삭제하시겠습니까?', ['취소', '확인']);"><i class="ico-review-del"></i><span>삭제</span></button></li>
            </ul>
          </div>
        </div>
        <div class="cont">
          <div class="img"><img src="../images/common/default-user.svg" alt=""></div>
          <div class="desc">
            <div class="name-area">
                <p class="name">홍길동</p>
                <p class="date">2024년 4월 20일</p>
            </div>
          </div>
        </div>
        <div class="text">다른 사람에게 추천받아서 듣게 됬는데 
          인강 안 받는 채질인데도 선생님 강의는 잘 들어오네요 ㅎㅎ 
          좋은 강의 추천합니다</div>
      </div>
      <div class="review modify" style="display:none;">
        <div class="byte"><em>0</em>/3000</div>
        <div class="cont">
          <div class="desc">
            <div class="name-area">
                <p class="name">홍길동</p>
            </div>
          </div>
        </div>
        <div class="form">
          <textarea rows="1"></textarea>
        </div>
        <div class="menu">
          <button type="button" class="btn-type5 btn-cancel">취소</button>
          <button type="button" class="btn-type5 st2 btn-regist">등록</button>
        </div>
      </div>
    </li>
  </ul>
</div>
<!-- // review-list -->
<div class="btn-wrap line-t" style="display: none;">
  <a href="javascript:void(0);" class="btn-type4 st3 w-size2">댓글 더보기</a>
  <a href="javascript:void(0);" class="btn-type4 st2 w-size2">목록</a>
</div>   
<div class="btn-more-view" style="display: none;">
  <button type="button"><span>더보기</span></button>
</div>          
<div class="paging-wrap" style="display: none;">
  <div class="paging">
    <button type="button" disabled class="btn-first"></button>
    <button type="button" disabled class="btn-prev"></button>
    <button type="button">1</button>
    <button type="button" class="on">2</button>
    <button type="button">3</button>
    <button type="button" class="btn-next"></button>
    <button type="button" class="btn-last"></button>
  </div>
</div>
<!-- // review-list-wrap -->


<script>
$(function () {
  const MAX_BYTE = 3000;
  const MIN_HEIGHT = 24;
  const encoder = new TextEncoder();

  const getByteLength = (str) => encoder.encode(str).length;

  const cutByByte = (str, maxByte) => {
    let bytes = 0;
    let result = '';

    for (const ch of str) {
      const chBytes = encoder.encode(ch).length;
      if (bytes + chBytes > maxByte) break;
      bytes += chBytes;
      result += ch;
    }
    return result;
  };

  const resizeTextarea = ($textarea, minHeight) => {
    $textarea[0].style.height = 'auto';
    $textarea[0].style.height = Math.max($textarea[0].scrollHeight, minHeight) + 'px';
  };

  const normalizeText = (text) => {
    return text
      .split('\n')
      .map(line => line.trim())
      .join('\n');
  };

  const calcByte = (text) => getByteLength(text);

  // ===========================
  // 공통 처리 함수
  // ===========================
  const bindTextarea = ($review) => {
    const $textarea = $review.find('textarea');
    const $byteEm = $review.find('.byte em');
    const $btnRegist = $review.find('.btn-regist');

    const minHeight = Math.max($textarea[0].scrollHeight, MIN_HEIGHT);

    const setByteAndBtn = (text) => {
      const bytes = calcByte(text);
      $byteEm.text(bytes);
      $btnRegist.toggleClass('st2', text.length > 0);
    };

    // 초기값 처리
    const initText = normalizeText($textarea.val());
    $textarea.val(initText);
    setByteAndBtn(initText);
    resizeTextarea($textarea, minHeight);

    // input 이벤트
    $textarea.on('input', function () {
      let v = normalizeText(this.value);
      let bytes = calcByte(v);

      if (bytes > MAX_BYTE) {
        v = cutByByte(v, MAX_BYTE);
        this.value = v;
        bytes = calcByte(v);
      }

      setByteAndBtn(v);
      resizeTextarea($textarea, minHeight);
    });
  };

  // ===========================
  // view -> modify 버튼 클릭
  // ===========================
  $(document).on('click', '.review.view .menu-layer .btn-modify', function () {
    const $viewReview = $(this).closest('.review.view');
    const $modifyReview = $viewReview.next('.review.modify');

    const viewText = normalizeText($viewReview.find('.text').text());
    const $textarea = $modifyReview.find('textarea');

    $textarea.data('originalText', viewText);
    $textarea.val(viewText).trigger('input');

    $viewReview.hide();
    $modifyReview.show();
  });

  // ===========================
  // regist 영역 처리
  // ===========================
  $('.review.regist').each(function () {
    const $review = $(this);
    bindTextarea($review);

    // 등록 버튼 클릭 시 (현재는 view 반영은 없음)
    $review.find('.btn-regist').on('click', function () {
      const text = normalizeText($review.find('textarea').val());
      console.log('등록 텍스트:', text);

      // 필요한 경우 여기서 서버 전송/리스트 추가 처리 가능
    });
  });

  // ===========================
  // modify 영역 처리
  // ===========================
  $('.review.modify').each(function () {
    const $review = $(this);
    bindTextarea($review);

    const $textarea = $review.find('textarea');

    // 등록 버튼
    $review.find('.btn-regist').on('click', function () {
      const newText = normalizeText($textarea.val());
      const $viewReview = $review.prev('.review.view');

      $viewReview.find('.text').text(newText);
      $review.hide();
      $viewReview.show();
    });

    // 취소 버튼
    $review.find('.btn-cancel').on('click', function () {
      const originalText = $textarea.data('originalText') || '';
      $textarea.val(originalText).trigger('input');

      $review.hide();
      $review.prev('.review.view').show();
    });
  });
});
</script>


















